generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  tenant
  landlord
}

enum RentPlanStatus {
  pending
  approved
  rejected
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  password      String
  name          String
  role          Role
  points        Int            @default(0)
  landlordId    String?
  landlord      User?          @relation("LandlordTenant", fields: [landlordId], references: [id])
  tenants       User[]         @relation("LandlordTenant")
  bills         Bill[]         @relation("TenantBills")
  managedBills  Bill[]         @relation("LandlordBills")
  expenses      Expense[]
  budgets       Budget[]
  rentPlans     RentPlan[]     @relation("TenantRentPlans")
  managedPlans  RentPlan[]     @relation("LandlordRentPlans")
  rewards       Reward[]
  redemptions   Redemption[]
  conversations Conversation[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model Bill {
  id          String    @id @default(uuid())
  tenantId    String
  landlordId  String
  type        String
  amount      Float
  dueDate     DateTime
  isPaid      Boolean   @default(false)
  paidDate    DateTime?
  description String?
  tenant      User      @relation("TenantBills", fields: [tenantId], references: [id])
  landlord    User      @relation("LandlordBills", fields: [landlordId], references: [id])
  rewards     Reward[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Expense {
  id          String   @id @default(uuid())
  tenantId    String
  category    String
  amount      Float
  date        DateTime
  description String?
  tenant      User     @relation(fields: [tenantId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Budget {
  id              String           @id @default(uuid())
  tenantId        String
  period          String // "week" | "month" | "all"
  amount          Float
  tenant          User             @relation(fields: [tenantId], references: [id])
  categoryBudgets CategoryBudget[]
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  @@unique([tenantId, period])
}

model CategoryBudget {
  id         String   @id @default(uuid())
  budgetId   String
  category   String
  percentage Float // Percentage of total budget (0-100)
  amount     Float
  budget     Budget   @relation(fields: [budgetId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([budgetId, category])
}

model RentPlan {
  id           String         @id @default(uuid())
  tenantId     String
  landlordId   String
  monthlyRent  Float
  deposit      Float
  duration     Int
  status       RentPlanStatus @default(pending)
  proposedDate DateTime       @default(now())
  reviewedDate DateTime?
  tenant       User           @relation("TenantRentPlans", fields: [tenantId], references: [id])
  landlord     User           @relation("LandlordRentPlans", fields: [landlordId], references: [id])
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
}

model ShopItem {
  id          String       @id @default(uuid())
  name        String
  description String
  pointCost   Int
  imageUrl    String?
  redemptions Redemption[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Redemption {
  id          String   @id @default(uuid())
  tenantId    String
  itemId      String
  itemName    String
  pointsSpent Int
  date        DateTime @default(now())
  tenant      User     @relation(fields: [tenantId], references: [id])
  item        ShopItem @relation(fields: [itemId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Reward {
  id           String   @id @default(uuid())
  tenantId     String
  billId       String
  amount       Float
  date         DateTime @default(now())
  isOnTime     Boolean
  pointsEarned Int
  tenant       User     @relation(fields: [tenantId], references: [id])
  bill         Bill     @relation(fields: [billId], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Conversation {
  id        String                @id @default(uuid())
  userId    String
  title     String?
  user      User                  @relation(fields: [userId], references: [id])
  messages  ConversationMessage[]
  createdAt DateTime              @default(now())
  updatedAt DateTime              @updatedAt
}

model ConversationMessage {
  id             String       @id @default(uuid())
  conversationId String
  role           String // 'user' or 'assistant'
  content        String       @db.Text
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  createdAt      DateTime     @default(now())
}
